services:
    nginx:
        image: nginx
        environment:
            - TZ=Europe/Paris
            - PUID=1000
            - PGID=1000
        ports:
            - "80:80"
            - "443:443"
        volumes:
            - ./serv/nginx.conf:/etc/nginx/conf.d/default.conf
            - ./dist:/usr/share/nginx/html
            - ./serv/certbot/conf:/etc/letsencrypt/:ro
            - ./serv/certbot/www:/var/www/certbot/:rw
            - ./serv/nginx/log:/var/log/nginx
        restart: unless-stopped
        depends_on:
            - express

    certbot:
        image: certbot/certbot
        environment:
            - TZ=Europe/Paris
            - PUID=1000
            - PGID=1000
        volumes:
            - ./serv/certbot/conf:/etc/letsencrypt/:rw
            - ./serv/certbot/www:/var/www/certbot/:rw
        depends_on:
            - nginx

    fail2ban:
        image: lscr.io/linuxserver/fail2ban:latest
        environment:
            - TZ=Europe/Paris
            - PUID=1000
            - PGID=1000
            - VERBOSITY=-vv #optional
        cap_add:
            - NET_ADMIN
            - NET_RAW
        network_mode: host
        restart: unless-stopped
        volumes:
            - ./serv/fail2ban:/config
            - ./serv/nginx/log:/var/log/nginx
            - /var/log:/var/log

    samba:
        image: dperson/samba
        environment:
            TZ: "Europe/Paris"
        networks:
            - default
        ports:
            - "139:139/tcp"
            - "466:466/tcp"
        read_only: false
        tmpfs:
            - /tmp
        restart: unless-stopped
        stdin_open: true
        tty: true
        volumes:
            - ./:/projet:z
        command: '-s "projet;/projet;yes;no;no;johan,erwan,melvin"
            -u "johan;johan"
            -u "erwan;erwan"
            -u "melvin;melvin" -p'

    adminer:
        image: adminer
        ports:
            - "127.0.0.1:8080:8080"
        environment:
            - ADMINER_DEFAULT_SERVER=postgres
        restart: unless-stopped

networks:
    default:
